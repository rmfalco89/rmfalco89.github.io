<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Evaluation System - Riccardo Marino</title>
    <link rel="stylesheet" href="../css/project.css">
</head>
<body>
    <nav class="back-nav">
        <a href="../index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Portfolio
        </a>
    </nav>
    
    <article class="project-detail">
        <header class="project-header">
            <h1>Stock Evaluation System</h1>
            <p class="subtitle">Automated Fundamental Stock Analysis</p>
            <div class="project-meta">
                <a href="https://github.com/rmfalco89/stocks_eval" target="_blank" class="github-link">
                    View on GitHub
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </a>
                <div class="tech-stack">
                    <span class="tech-tag">Python</span>
                    <span class="tech-tag">Selenium</span>
                    <span class="tech-tag">BeautifulSoup</span>
                    <span class="tech-tag">Pandas</span>
                    <span class="tech-tag">Docker</span>
                </div>
            </div>
        </header>
        
        <section class="content-section">
            <h2>The Problem</h2>
            <p>Value investing requires rigorous fundamental analysis — calculating growth rates, debt ratios, intrinsic valuations, and margin of safety levels. For a single stock, this means:</p>
            <ul>
                <li>Manual data collection from multiple financial websites (Morningstar, Macrotrends, Zacks)</li>
                <li>Calculating the "Big 5" metrics: Equity, EPS, Sales, Cash Flow growth rates + ROIC/ROE</li>
                <li>Computing sticker price: Intrinsic value based on future EPS projections</li>
                <li>Determining margin of safety levels: 20%, 30%, 40%, and 50% discounts</li>
                <li>Tracking dozens of stocks to identify buying opportunities</li>
            </ul>
            <p>Doing this manually for even a small watch list of 30-50 stocks is time-prohibitive. And financial data sources impose aggressive rate limits, making bulk scraping unreliable.</p>
        </section>
        
        <section class="content-section">
            <h2>The Solution</h2>
            <p><strong>stocks_eval</strong> is a Python automation framework that:</p>
            <ul class="highlights-list">
                <li>Scrapes financial data from multiple sources using intelligent web automation</li>
                <li>Implements Phil Town's Rule #1 calculations for intrinsic valuation</li>
                <li>Processes entire watch lists in batch mode with caching and rate-limit evasion</li>
                <li>Generates actionable reports identifying stocks trading below their margin of safety</li>
                <li>Supports Docker deployment with a two-stage architecture for production use</li>
            </ul>
        </section>
        
        <section class="content-section">
            <h2>Architecture: Three-Tier Data Flow</h2>
            <div class="architecture-diagram">
                <pre>
┌─────────────────────────────────────────────────────────────┐
│  Data Gathering Layer (Modular Web Scrapers)                │
├─────────────────────────────────────────────────────────────┤
│  • MorningstarGatherer    → Balance sheet, income, cash flow│
│  • MacrotrendsGatherer    → Historical ratios & trends      │
│  • PriceGatherer (yfinance) → Current stock prices          │
│  • ZacksGatherer          → Analyst earnings estimates      │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  Analysis Engine (DataAnalyzer)                             │
├─────────────────────────────────────────────────────────────┤
│  • Parse & normalize financial data from multiple sources   │
│  • Calculate Big 5 growth rates (8-10 year historical)      │
│  • Compute sticker price using future value formulas        │
│  • Calculate 4 margin of safety levels (20-50% discounts)   │
│  • Score data quality based on historical coverage          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│  Reporting Layer                                            │
├─────────────────────────────────────────────────────────────┤
│  • TSV files: raw data, Big 5 metrics, valuations           │
│  • Human-readable text reports                              │
│  • JSON exports for programmatic consumption                │
│  • Email delivery via Gmail SMTP or system mail             │
└─────────────────────────────────────────────────────────────┘
                </pre>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Key Technical Features</h2>
            
            <div class="feature-card">
                <h3>Rate-Limit Evasion via Intelligent Caching</h3>
                <ul>
                    <li><strong>Page-level caching:</strong> HTML responses stored locally in <code>cached_pages/</code></li>
                    <li><strong>Configurable TTL:</strong> Avoids re-scraping unless explicitly invalidated</li>
                    <li><strong>Per-source rate limiting:</strong> Morningstar set to 1 request/60 seconds</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Selenium Automation with undetected-chromedriver</h3>
                <p>Morningstar dynamically loads data via JavaScript and has anti-bot protections:</p>
                <ul>
                    <li>Click automation to expand "10 Years" historical data</li>
                    <li>Headless mode for server deployment</li>
                    <li>undetected-chromedriver bypasses basic anti-automation detection</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Rule #1 Sticker Price Calculation</h3>
                <p>Phil Town's method calculates intrinsic value based on:</p>
                <ul>
                    <li><strong>Future EPS:</strong> Projected 10 years out using analyst estimates or historical growth</li>
                    <li><strong>Future PE ratio:</strong> Conservative estimate based on historical PE (capped at 2x growth rate)</li>
                    <li><strong>Present value discount:</strong> What you'd pay today for that future value</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Multi-Source Data Aggregation</h3>
                <table style="width:100%; border-collapse: collapse; margin-top: 16px;">
                    <thead>
                        <tr style="border-bottom: 1px solid var(--lightest-navy);">
                            <th style="text-align: left; padding: 8px; color: var(--lightest-slate);">Source</th>
                            <th style="text-align: left; padding: 8px; color: var(--lightest-slate);">Best For</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--lightest-navy);">
                            <td style="padding: 8px;">Morningstar</td>
                            <td style="padding: 8px;">Primary financials (10yr history)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--lightest-navy);">
                            <td style="padding: 8px;">Macrotrends</td>
                            <td style="padding: 8px;">Historical PE ratios & trends</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--lightest-navy);">
                            <td style="padding: 8px;">yfinance</td>
                            <td style="padding: 8px;">Current prices</td>
                        </tr>
                        <tr>
                            <td style="padding: 8px;">Zacks</td>
                            <td style="padding: 8px;">Analyst earnings estimates</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="feature-card">
                <h3>Two-Stage Docker Pattern</h3>
                <p>To avoid rate-limiting issues in production:</p>
                <p><strong>Stage 1: Data Gatherer</strong> (run weekly)</p>
                <ul>
                    <li>Performs web scraping using Selenium + undetected-chromedriver</li>
                    <li>Saves data to TSV files</li>
                    <li>Heavy on I/O, minimizes API calls</li>
                </ul>
                <p><strong>Stage 2: Stock Analyzer</strong> (run daily/hourly)</p>
                <ul>
                    <li>Reads pre-existing TSV files</li>
                    <li>Fetches current prices only (lightweight)</li>
                    <li>Performs analysis and sends reports</li>
                    <li>No rate-limit concerns</li>
                </ul>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Usage</h2>
            <p><strong>Single Stock Analysis:</strong></p>
            <div class="code-block">
                <pre>
poetry run python src/eval_stock.py \
  --ticker AAPL \
  --market xnas \
  --earnings-estimate 0.15
                </pre>
            </div>
            
            <p><strong>Batch Analysis (All Watch List Stocks):</strong></p>
            <div class="code-block">
                <pre>
poetry run python batch_analyzer.py \
  --watch-list watch_list.yaml \
  --email-to investor@example.com \
  --output-json results.json
                </pre>
            </div>
            
            <p><strong>Sample Output:</strong></p>
            <div class="code-block">
                <pre>
BUY OPPORTUNITIES (Current price below MOS):
--------------------------------------------------
  AVGO   (mos_20) - $ 283.34 vs $ 304.07 (  6.8% below target)
  NVDA   (mos_30) - $ 612.00 vs $ 680.50 ( 10.1% below target)
                </pre>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Real-World Impact</h2>
            <p>For serious value investors managing a 30-50 stock watch list:</p>
            <ul class="highlights-list">
                <li><strong>Manual time:</strong> ~2 hours per stock × 30 stocks = 60 hours/month</li>
                <li><strong>Automated time:</strong> 5 minutes for initial setup + 30 seconds per run</li>
                <li><strong>ROI:</strong> Hundreds of hours saved annually while maintaining analytical rigor</li>
            </ul>
        </section>
        
        <section class="content-section">
            <h2>Technical Highlights</h2>
            <ul class="highlights-list">
                <li><strong>Domain-specific automation:</strong> Implements a published investment methodology in code</li>
                <li><strong>Rate-limit resilience:</strong> Two-stage architecture + caching system</li>
                <li><strong>Multi-source data fusion:</strong> Combines web scraping, APIs, and manual overrides</li>
                <li><strong>Practical value investing:</strong> Turns hours of spreadsheet work into automated buy signals</li>
                <li><strong>BeautifulSoup flexible parsing:</strong> Handles varying HTML structures</li>
                <li><strong>Docker-ready two-stage pipeline:</strong> Separates heavy scraping from lightweight analysis</li>
            </ul>
        </section>
    </article>
</body>
</html>
