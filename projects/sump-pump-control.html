<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sump Pump Manager - Riccardo Marino</title>
    <link rel="stylesheet" href="../css/project.css">
</head>
<body>
    <nav class="back-nav">
        <a href="../index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Portfolio
        </a>
    </nav>
    
    <article class="project-detail">
        <header class="project-header">
            <h1>Sump Pump Manager (SPM)</h1>
            <p class="subtitle">Intelligent Dual-Pump Water Management System</p>
            <div class="project-meta">
                <a href="https://github.com/rmfalco89/sump_pump-control" target="_blank" class="github-link">
                    View on GitHub
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </a>
                <div class="tech-stack">
                    <span class="tech-tag">C++</span>
                    <span class="tech-tag">ESP32/ESP8266</span>
                    <span class="tech-tag">PlatformIO</span>
                    <span class="tech-tag">Home Assistant</span>
                </div>
            </div>
        </header>
        
        <section class="content-section">
            <h2>The Problem</h2>
            <p>After a power outage in early 2024, a basement flooded and the existing high-powered sump pump nearly caused a disaster—its powerful discharge overwhelmed the sewage line, causing water to back up through the kitchen sink. The homeowner wanted to add a second, gentler pump that would discharge into an irrigation tank instead, but faced several constraints:</p>
            <ul>
                <li><strong>Physical space:</strong> Only one bucket/pit in the basement floor—no room for a second float switch</li>
                <li><strong>Pump limitation:</strong> The new pump isn't self-priming, so it can't run dry</li>
                <li><strong>Coordination complexity:</strong> Two pumps with different discharge points need intelligent orchestration</li>
                <li><strong>Reliability:</strong> Must handle edge cases like flood scenarios, sensor failures, and relay overheating</li>
            </ul>
            <p>The solution needed to be robust, configurable, and capable of operating autonomously while integrating with Home Assistant for monitoring and alerts.</p>
        </section>
        
        <section class="content-section">
            <h2>The Solution</h2>
            <p>SPM is an embedded IoT controller that coordinates two sump pumps using multiple sensors and configurable operating modes. The system runs on an ESP32/ESP8266 microcontroller and exposes a web interface for configuration and monitoring.</p>
        </section>
        
        <section class="content-section">
            <h2>Key Features</h2>
            
            <div class="feature-card">
                <h3>Multi-Sensor Water Level Detection</h3>
                <ul>
                    <li>5 float switches at different heights (bottom, middle-bottom, middle-middle, middle-top, top)</li>
                    <li>TF-Luna LIDAR sensor for precise distance measurement</li>
                    <li>Configurable sensor selection for different middle-level triggers</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Flexible Operating Modes</h3>
                <ul>
                    <li><code>AUTO</code>: Float switch-driven activation</li>
                    <li><code>TIMED</code>: Run/rest cycles (e.g., 2 min on, 3 min off)</li>
                    <li><code>AUTOTIMED</code>: Hybrid mode combining both</li>
                    <li><code>TIMEBASED</code>: Delayed activation after sustained water level</li>
                    <li><code>INACTIVE</code>: Manual override to disable</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Safety & Monitoring</h3>
                <ul>
                    <li>Temperature monitoring on solid-state relay (SSR) to prevent overheating</li>
                    <li>Flood mode detection when bucket doesn't empty within expected time</li>
                    <li>Home Assistant integration for alerts and health checks</li>
                    <li>Adaptive timing for time-based mode (auto-adjusts wait period based on pump performance)</li>
                </ul>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Architecture</h2>
            <div class="architecture-diagram">
                <pre>
┌─────────────────────────────────────────────┐
│            ESP32 Controller                  │
├─────────────────────────────────────────────┤
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  │
│  │  Float   │  │  LIDAR   │  │   Temp   │  │
│  │ Switches │  │ Sensor   │  │  Sensor  │  │
│  └────┬─────┘  └────┬─────┘  └────┬─────┘  │
│       └─────────────┼─────────────┘         │
│                     ▼                        │
│         ┌──────────────────────┐            │
│         │   Control Logic      │            │
│         │  (State Machine)     │            │
│         └──────────┬───────────┘            │
│                    ▼                         │
│       ┌───────────────────────┐             │
│       │  Pump Controllers     │             │
│       └──────┬─────────┬──────┘             │
│              ▼         ▼                     │
│         ┌────────┐ ┌────────┐               │
│         │ SSR    │ │Standard│               │
│         │ Relay  │ │ Relay  │               │
│         └───┬────┘ └───┬────┘               │
└─────────────┼──────────┼────────────────────┘
              ▼          ▼
         ┌────────┐ ┌────────┐
         │  New   │ │  Old   │
         │  Pump  │ │  Pump  │
         └────────┘ └────────┘
                </pre>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Technical Highlights</h2>
            <ul class="highlights-list">
                <li><strong>Real-time responsiveness:</strong> 50ms main loop with non-blocking async web server</li>
                <li><strong>Persistent configuration:</strong> EEPROM storage with structure packing</li>
                <li><strong>Cross-platform:</strong> Supports both ESP32 and ESP8266 via PlatformIO build targets</li>
                <li><strong>Diagnostics:</strong> Comprehensive status reporting via serial console and web interface</li>
                <li><strong>Safety-first:</strong> Multiple redundant sensors and fail-safe modes</li>
            </ul>
        </section>
        
        <section class="content-section">
            <h2>Why It's Interesting</h2>
            <p>This project exemplifies practical embedded systems development:</p>
            <ul>
                <li><strong>Real-world problem solving:</strong> Addresses an actual home flooding risk with multiple constraints</li>
                <li><strong>Sensor fusion:</strong> Combines float switches and LIDAR for robust water level detection</li>
                <li><strong>Adaptive algorithms:</strong> Self-tuning timers based on observed performance</li>
                <li><strong>Fail-safe design:</strong> Multiple layers of safety checks and emergency modes</li>
                <li><strong>IoT integration:</strong> Home Assistant webhooks for remote monitoring and alerts</li>
                <li><strong>Maintainability:</strong> Clean abstractions (Relay, SumpPump) with comprehensive logging</li>
            </ul>
            <p>The code demonstrates how embedded C++ can be organized for clarity without sacrificing performance—a balance often lost in Arduino projects.</p>
        </section>
    </article>
</body>
</html>
