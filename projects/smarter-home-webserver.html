<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmarterHome Webserver - Riccardo Marino</title>
    <link rel="stylesheet" href="../css/project.css">
</head>
<body>
    <nav class="back-nav">
        <a href="../index.html" class="back-link">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
            Back to Portfolio
        </a>
    </nav>
    
    <article class="project-detail">
        <header class="project-header">
            <h1>SmarterHome Webserver</h1>
            <p class="subtitle">Advanced Home Automation Orchestration</p>
            <div class="project-meta">
                <a href="https://github.com/rmfalco89/smarterHome-webserver" target="_blank" class="github-link">
                    View on GitHub
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                        <polyline points="15 3 21 3 21 9"></polyline>
                        <line x1="10" y1="14" x2="21" y2="3"></line>
                    </svg>
                </a>
                <div class="tech-stack">
                    <span class="tech-tag">Python</span>
                    <span class="tech-tag">Django 5.0</span>
                    <span class="tech-tag">REST API</span>
                    <span class="tech-tag">WebSocket</span>
                    <span class="tech-tag">Plotly</span>
                </div>
            </div>
        </header>
        
        <section class="content-section">
            <h2>Overview</h2>
            <p>SmarterHome Webserver is a sophisticated Django-based orchestration layer that sits between IoT sensor devices and home automation platforms (Homebridge and Home Assistant). It provides centralized monitoring, control logic, and data analytics for custom smart home devices—with a particularly interesting application: automated mushroom cultivation.</p>
        </section>
        
        <section class="content-section">
            <h2>Architecture</h2>
            <div class="architecture-diagram">
                <pre>
┌─────────────┐
│   Arduino   │ ──HTTP POST──> ┌──────────────────┐
│   Devices   │ <──Firmware──── │  Django Server   │
└─────────────┘                 │                  │
                                │  ┌────────────┐  │
┌─────────────┐                 │  │ Device     │  │
│ Homebridge  │ <──REST API───> │  │ Control    │  │
│   Server    │                 │  └────────────┘  │
└─────────────┘                 │                  │
                                │  ┌────────────┐  │
┌─────────────┐                 │  │ HomeAssist │  │
│    Home     │ <──WebSocket──> │  │ Control    │  │
│  Assistant  │                 │  └────────────┘  │
└─────────────┘                 └──────────────────┘
                </pre>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Core Features</h2>
            
            <div class="feature-card">
                <h3>Smart Data Persistence with Delta Compression</h3>
                <p>One of the most elegant optimizations is delta-based data storage for sensor readings:</p>
                <ul>
                    <li>Sensors report every ~2 minutes, but temp/humidity change slowly</li>
                    <li>Instead of creating a new DB row for 75.1°F → 75.2°F, increment the counter</li>
                    <li>One row with counter=30 represents ~1 hour of stable readings</li>
                    <li>Dramatically reduces database size while maintaining full historical accuracy</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Threshold-Based Automation with Hysteresis</h3>
                <p>Intelligent threshold control to prevent rapid on/off cycling:</p>
                <ul>
                    <li><strong>Example:</strong> Target temp = 75°F, gap = 2°F</li>
                    <li>Heater turns ON when temp &lt; 73°F</li>
                    <li>Heater turns OFF when temp &gt; 77°F</li>
                    <li>Between 73-77°F: maintain current state</li>
                    <li>Prevents the "chattering" problem where devices rapidly toggle</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Multi-Platform Integration</h3>
                <p><strong>Homebridge (HTTP REST API):</strong></p>
                <ul>
                    <li>Authenticates with Homebridge UI</li>
                    <li>Token refresh with expiration checking</li>
                    <li>Caches accessory list (2 min dev, 8 hours prod)</li>
                </ul>
                <p><strong>Home Assistant (WebSocket):</strong></p>
                <ul>
                    <li>WebSocket connection with reconnection logic</li>
                    <li>Long-lived access tokens</li>
                    <li>Updates virtual sensors in real-time</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>Over-The-Air (OTA) Firmware Updates</h3>
                <p>Devices can self-update when new firmware is available:</p>
                <ul>
                    <li>Device POSTs its current version on startup</li>
                    <li>Server checks GitHub releases for newer firmware</li>
                    <li>If available, device downloads and flashes new version</li>
                    <li>Device reboots with updated firmware</li>
                </ul>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Mushroom Growing Automation</h2>
            <p>The <code>shrooms</code> app is specifically designed for automated mushroom cultivation:</p>
            <ul class="highlights-list">
                <li><strong>Growing stage:</strong> Higher humidity (95%+), lower temp, minimal FAE</li>
                <li><strong>Fruiting stage:</strong> Lower humidity (85-90%), higher temp, frequent FAE</li>
                <li><strong>Automated transitions</strong> between stages based on schedule</li>
                <li><strong>Fine-grained FAE control:</strong> Long intervals with occasional short "push" cycles</li>
                <li><strong>Precise environmental control</strong> required for successful mushroom cultivation</li>
            </ul>
        </section>
        
        <section class="content-section">
            <h2>Device Protocol</h2>
            <p><strong>Device Reports Sensor Data:</strong></p>
            <div class="code-block">
                <pre>
POST /homebridgecomm/reading/bedroom_sensor
Content-Type: application/json

{
  "temp": 72.5,
  "rh": 65.3
}
                </pre>
            </div>
            <p><strong>Server Responds with Action:</strong></p>
            <div class="code-block">
                <pre>
HTTP/1.1 200 OK

Turn heater ON
                </pre>
            </div>
        </section>
        
        <section class="content-section">
            <h2>Data Visualization</h2>
            <p>Real-time and historical monitoring dashboard with Plotly:</p>
            <ul>
                <li>Interactive date range selection</li>
                <li>Temperature and humidity on same graph</li>
                <li>Visual markers for device restarts and control actions</li>
                <li>Gap detection when devices go offline</li>
                <li>Expands counter values for accurate visualization</li>
            </ul>
        </section>
        
        <section class="content-section">
            <h2>Real-World Application</h2>
            <p>This isn't a toy project—it's a production system managing:</p>
            <ul class="highlights-list">
                <li><strong>Multiple temp/humidity sensors</strong> in different rooms</li>
                <li><strong>Smart switches and heaters</strong> via Homebridge</li>
                <li><strong>Mushroom growing chambers</strong> with specialized control</li>
                <li><strong>Firmware updates</strong> for custom Arduino devices</li>
                <li><strong>Historical data</strong> for trend analysis</li>
            </ul>
            <p>The system runs continuously on a local server, with devices checking in every ~2 minutes. The delta compression means months of data fit in a lightweight SQLite database, and the visualization tools provide immediate insight into environmental trends.</p>
        </section>
        
        <section class="content-section">
            <h2>Technical Highlights</h2>
            <ul class="highlights-list">
                <li><strong>Clean separation of concerns:</strong> Models, control logic, views</li>
                <li><strong>Comprehensive logging</strong> throughout</li>
                <li><strong>Graceful error handling</strong> with fallbacks</li>
                <li><strong>Singleton pattern</strong> for expensive resources</li>
                <li><strong>Caching strategy</strong> to reduce load</li>
                <li><strong>Delta compression</strong> for efficient storage</li>
            </ul>
        </section>
    </article>
</body>
</html>
